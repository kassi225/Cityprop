{% load static %}
{% load humanize %}
{% load pdf_extras %}

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>{{ facture.type_document }} {{ facture.numero_document }}</title>

<style>
/* ... (Le style CSS reste inchangÃ©) ... */
/* ================= PAGE A4 ================= */
@page {
Â  Â  size: A4;
Â  Â  margin: 1.6cm;

Â  Â  @frame footer_frame {
Â  Â  Â  Â  -pdf-frame-content: footerContent;
Â  Â  Â  Â  bottom: 0cm;
Â  Â  Â  Â  margin-left: 1.6cm;
Â  Â  Â  Â  margin-right: 1.6cm;
Â  Â  Â  Â  height: 2.2cm;
Â  Â  }
}

body {
Â  Â  font-family: Helvetica, Arial, sans-serif;
Â  Â  font-size: 9.8pt;
Â  Â  color: #1f2937;
Â  Â  line-height: 1.45;
}

/* ================= HEADER ================= */
.header {
Â  Â  border-bottom: 2px solid #1e3a8a;
Â  Â  padding-bottom: 10px;
Â  Â  margin-bottom: 5px;
}



.header-table {
Â  Â  width: 100%;
}

.logo {
Â  Â  width: 80px; /* ðŸ”¥ LOGO MIS EN VALEUR */
Â  Â  margin-bottom: 4px;
}

.company-name {
Â  Â  font-size: 14.5pt;
Â  Â  font-weight: bold;
Â  Â  color: #1e3a8a;
}

.company-tagline {
Â  Â  font-size: 8.5pt;
Â  Â  color: #555;
}

.doc-box {
Â  Â  text-align: right;
}

.doc-title {
Â  Â  font-size: 15pt;
Â  Â  font-weight: bold;
}

.doc-number {
Â  Â  font-size: 9pt;
Â  Â  color: #444;
}

/* ================= INFO CLIENT ================= */
.info-table {
Â  Â  width: 100%;
Â  Â  margin-bottom: 14px;
}

.client-box {
Â  Â  border: 1px solid #cbd5e1;
Â  Â  padding: 8px;
Â  Â  font-size: 9pt;
Â  Â  line-height: 1.4;
}

.client-box strong {
Â  Â  color: #1e3a8a;
}

/* ================= TABLE FACTURE ================= */
.items-table {
Â  Â  width: 100%;
Â  Â  border-collapse: collapse;
Â  Â  margin-top: 10px;
}

.items-table th {
Â  Â  background: #f1f5f9;
Â  Â  font-size: 9pt;
Â  Â  padding: 6px;
Â  Â  border: 1px solid #000;
Â  Â  text-align: center;
}

.items-table td {
Â  Â  border: 1px solid #000;
Â  Â  padding: 6px;
Â  Â  font-size: 9pt;
}

.text-right { text-align: right; }
.text-center { text-align: center; }

/* ================= TOTALS ================= */
.total-row {
Â  Â  background: #e5e7eb;
Â  Â  font-weight: bold;
}

.reduction-row {
Â  Â  background: #fee2e2;
Â  Â  color: #991b1b;
Â  Â  font-weight: bold;
}

.net-row {
Â  Â  background: #1e3a8a;
Â  Â  color: #fff;
Â  Â  font-size: 10.5pt;
Â  Â  font-weight: bold;
}

/* ================= SIGNATURE ================= */
.signature {
Â  Â  margin-top: 20px;
Â  Â  text-align: right;
Â  Â  font-weight: bold;
Â  Â  font-size: 9.5pt;
}
.logo {
Â  Â  width: 80px;
}
</style>
</head>

<body>

<div class="header">
<table class="header-table">
<tr>
<td>
Â  Â <img src="{{ 'images/cityprop_logo.png'|pdf_static }}" class="logo"><br>
Â  Â  <span class="company-name">CITY PROP</span><br>
Â  Â  <span class="company-tagline">Nettoyage industriel & assainissement</span>
</td>
<td class="doc-box">
Â  Â  <div class="doc-title">{{ facture.type_document|upper }}</div>
Â  Â  <div class="doc-number">NÂ° {{ facture.numero_document }}</div>
Â  Â  <div class="doc-number">Ã‰mise le {{ facture.date_emission|date:"d/m/Y" }}</div>
</td>
</tr>
</table>
</div>

<table class="info-table">
<tr>
<td style="width:60%; vertical-align: top;">
Â  Â  <strong>Objet :</strong><br>
Â  Â  {{ facture.objet|default:"Prestations professionnelles de nettoyage" }}
</td>
<td style="width:40%; vertical-align: top;">
Â  Â  <div class="client-box">
Â  Â  Â  Â  <strong>CLIENT :</strong> {{ facture.commande.nom_client|upper }}<br>
Â  Â  Â  Â  <strong>LIEU :</strong> {{ facture.commande.localisation_client }}<br>
Â  Â  Â  Â  <strong>TÃ‰L :</strong> {{ facture.commande.numero_client }}
Â  Â  </div>
</td>
</tr>
</table>

<table class="items-table">
<thead>
<tr>
Â  Â  <th>DÃ©signation</th>
Â  Â  <th>QtÃ©</th>
Â  Â  <th>Prix unitaire (FCFA)</th>
Â  Â  <th>Total (FCFA)</th>
</tr>
</thead>
<tbody>
{% for ligne in facture.lignes.all %}
<tr>
Â  Â  <td>
Â  Â  Â  Â  {{ ligne.designation }}
Â  Â  Â  Â  {% if ligne.note_prix_unitaire %}
Â  Â  Â  Â  Â  Â  <br><small style="color:#555;">{{ ligne.note_prix_unitaire }}</small>
Â  Â  Â  Â  {% endif %}
Â  Â  </td>
Â  Â  <td class="text-center">{{ ligne.quantite }}</td>
Â  Â  <td class="text-right">{{ ligne.prix_unitaire|intcomma }}</td>
Â  Â  <td class="text-right">{{ ligne.prix_total|intcomma }}</td>
</tr>
{% endfor %}

<tr class="total-row">
Â  Â  <td colspan="3" class="text-right">TOTAL HT DES LIGNES</td>
Â  Â  <td class="text-right">{{ facture.total_ht_lignes|intcomma }}</td>
</tr>

{% if facture.montant_reduction > 0 %}
<tr class="reduction-row">
Â  Â  <td colspan="3" class="text-right">
Â  Â  Â  Â  RÃ‰DUCTION
Â  Â  Â  Â  {% if facture.taux_reduction_pourcentage %}
Â  Â  Â  Â  Â  Â  ({{ facture.taux_reduction_pourcentage|intcomma }} %)
Â  Â  Â  Â  {% endif %}
Â  Â  </td>
Â  Â  <td class="text-right">- {{ facture.montant_reduction|intcomma }}</td>
</tr>
{% endif %}

<tr class="net-row">
Â  Â  <td colspan="3" class="text-right">MONTANT NET Ã€ PAYER</td>
Â  Â  <td class="text-right">{{ facture.montant_final_net|intcomma }}</td>
</tr>
</tbody>
</table>

<p style="margin-top:10px; font-size:9.5pt;">
ArrÃªtÃ©e la prÃ©sente facture Ã  la somme de :
<strong>{{ facture.total_lettres }}</strong>
</p>

<div class="signature">
{{ facture.lieu_emission|default:"Abidjan" }}, le {{ facture.date_emission|date:"d/m/Y" }}<br><br>
{{ facture.signature|default:"LA COMPTABILITÃ‰"|upper }}
</div>

<div id="footerContent" style="font-size:8pt; text-align:center; color:#444;">
CITY PROP SARL â€“ Capital 1 000 000 FCFA â€“ Cocody Abatta, Abidjan<br>
TÃ©l : (+225) 0747355400 / 0778176097 â€“ citypropre@gmail.com<br>
RCCM CI-ABJ-03-2022-B13-11314
</div>

</body>
</html>