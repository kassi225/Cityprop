{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>{{ facture.type_document }} {{ facture.numero_document }}</title>

<style>
/* ================= PAGE A4 ================= */
@page {
    size: A4;
    margin: 1.6cm;

    @frame footer_frame {
        -pdf-frame-content: footerContent;
        bottom: 0cm;
        margin-left: 1.6cm;
        margin-right: 1.6cm;
        height: 2.2cm;
    }
}

body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 9.8pt;
    color: #1f2937;
    line-height: 1.45;
}

/* ================= HEADER ================= */
.header {
    border-bottom: 2px solid #1e3a8a;
    padding-bottom: 10px;
    margin-bottom: 16px;
}

.header-table {
    width: 100%;
}

.logo {
    width: 80px; /* ðŸ”¥ LOGO MIS EN VALEUR */
    margin-bottom: 4px;
}

.company-name {
    font-size: 14.5pt;
    font-weight: bold;
    color: #1e3a8a;
}

.company-tagline {
    font-size: 8.5pt;
    color: #555;
}

.doc-box {
    text-align: right;
}

.doc-title {
    font-size: 15pt;
    font-weight: bold;
}

.doc-number {
    font-size: 9pt;
    color: #444;
}

/* ================= INFO CLIENT ================= */
.info-table {
    width: 100%;
    margin-bottom: 14px;
}

.client-box {
    border: 1px solid #cbd5e1;
    padding: 8px;
    font-size: 9pt;
    line-height: 1.4;
}

.client-box strong {
    color: #1e3a8a;
}

/* ================= TABLE FACTURE ================= */
.items-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

.items-table th {
    background: #f1f5f9;
    font-size: 9pt;
    padding: 6px;
    border: 1px solid #000;
    text-align: center;
}

.items-table td {
    border: 1px solid #000;
    padding: 6px;
    font-size: 9pt;
}

.text-right { text-align: right; }
.text-center { text-align: center; }

/* ================= TOTALS ================= */
.total-row {
    background: #e5e7eb;
    font-weight: bold;
}

.reduction-row {
    background: #fee2e2;
    color: #991b1b;
    font-weight: bold;
}

.net-row {
    background: #1e3a8a;
    color: #fff;
    font-size: 10.5pt;
    font-weight: bold;
}

/* ================= SIGNATURE ================= */
.signature {
    margin-top: 20px;
    text-align: right;
    font-weight: bold;
    font-size: 9.5pt;
}
.logo {
    width: 80px;
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="header">
<table class="header-table">
<tr>
<td>
   <img src="{{ 'images/cityprop_logo.png'|pdf_static }}" class="logo"><br>
    <span class="company-name">CITY PROP</span><br>
    <span class="company-tagline">Nettoyage industriel & assainissement</span>
</td>
<td class="doc-box">
    <div class="doc-title">{{ facture.type_document|upper }}</div>
    <div class="doc-number">NÂ° {{ facture.numero_document }}</div>
    <div class="doc-number">Ã‰mise le {{ facture.date_emission|date:"d/m/Y" }}</div>
</td>
</tr>
</table>
</div>

<!-- ================= INFOS CLIENT ================= -->
<table class="info-table">
<tr>
<td style="width:60%; vertical-align: top;">
    <strong>Objet :</strong><br>
    {{ facture.objet|default:"Prestations professionnelles de nettoyage" }}
</td>
<td style="width:40%; vertical-align: top;">
    <div class="client-box">
        <strong>CLIENT :</strong> {{ facture.commande.nom_client|upper }}<br>
        <strong>LIEU :</strong> {{ facture.commande.localisation_client }}<br>
        <strong>TÃ‰L :</strong> {{ facture.commande.numero_client }}
    </div>
</td>
</tr>
</table>

<!-- ================= LIGNES FACTURE ================= -->
<table class="items-table">
<thead>
<tr>
    <th>DÃ©signation</th>
    <th>QtÃ©</th>
    <th>Prix unitaire (FCFA)</th>
    <th>Total (FCFA)</th>
</tr>
</thead>
<tbody>
{% for ligne in facture.lignes.all %}
<tr>
    <td>
        {{ ligne.designation }}
        {% if ligne.note_prix_unitaire %}
            <br><small style="color:#555;">{{ ligne.note_prix_unitaire }}</small>
        {% endif %}
    </td>
    <td class="text-center">{{ ligne.quantite }}</td>
    <td class="text-right">{{ ligne.prix_unitaire|intcomma }}</td>
    <td class="text-right">{{ ligne.prix_total|intcomma }}</td>
</tr>
{% endfor %}

<tr class="total-row">
    <td colspan="3" class="text-right">SOUS-TOTAL</td>
    <td class="text-right">{{ facture.total|intcomma }}</td>
</tr>

{% if facture.montant_reduction > 0 %}
<tr class="reduction-row">
    <td colspan="3" class="text-right">
        RÃ‰DUCTION
        {% if facture.taux_reduction_pourcentage %}
            ({{ facture.taux_reduction_pourcentage }} %)
        {% endif %}
    </td>
    <td class="text-right">- {{ facture.montant_reduction|intcomma }}</td>
</tr>
{% endif %}

<tr class="net-row">
    <td colspan="3" class="text-right">MONTANT NET Ã€ PAYER</td>
    <td class="text-right">{{ facture.montant_final_net|intcomma }}</td>
</tr>
</tbody>
</table>

<!-- ================= TOTAL EN LETTRES ================= -->
<p style="margin-top:10px; font-size:9.5pt;">
ArrÃªtÃ©e la prÃ©sente facture Ã  la somme de :
<strong>{{ facture.total_lettres }}</strong>
</p>

<!-- ================= SIGNATURE ================= -->
<div class="signature">
{{ facture.lieu_emission|default:"Abidjan" }}, le {{ facture.date_emission|date:"d/m/Y" }}<br><br>
{{ facture.signature|default:"LA COMPTABILITÃ‰"|upper }}
</div>

<!-- ================= FOOTER FIXÃ‰ ================= -->
<div id="footerContent" style="font-size:8pt; text-align:center; color:#444;">
CITY PROP SARL â€“ Capital 1 000 000 FCFA â€“ Cocody Abatta, Abidjan<br>
TÃ©l : (+225) 0747355400 / 0778176097 â€“ citypropre@gmail.com<br>
RCCM CI-ABJ-03-2022-B13-11314
</div>

</body>
</html>
